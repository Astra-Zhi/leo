# leo 模块 - 数据处理与操作工具库

`leo` 模块提供了一系列用于数据处理和操作的工具函数，包括因子编码、多维数组创建、数据框构建、列表管理以及管道操作。这些工具旨在简化数据处理流程，提高代码的可读性和效率。

## 目录

- [Factor() - 创建因子对象](#factor---创建因子对象)
- [Array() - 创建多维数组](#array---创建多维数组)
- [Matrix() - 创建二维矩阵](#matrix---创建二维矩阵)
- [DataFrame() - 创建数据框对象](#dataframe---创建数据框对象)
- [List() - 创建列表对象](#list---创建列表对象)
- [Pipe() - 创建管道对象](#pipe---创建管道对象)
- [Summary() - 计算统计摘要](#summary---计算统计摘要)
- [Which() - 查找满足条件的元素索引](#which---查找满足条件的元素索引)
- [Is_na() - 检查 nil 元素](#is_na---检查-nil-元素)
- [Na_omit() - 移除-nil-元素](#na_omit---移除-nil-元素)
- [Narm - 忽略-nil-计算平均值](#narm---忽略-nil-计算平均值)


## 核心目标
简化数据处理流程：leo 模块提供了从基础数据结构创建到复杂数据操作的一系列函数，使得开发者可以更专注于业务逻辑，而无需担心底层实现细节。
增强代码可读性和效率：通过封装常见的数据处理任务，leo 模块帮助编写更加简洁、易懂的代码，同时优化了性能，确保在大数据集上也能高效运行。
支持多种数据类型：无论是数值、字符串、布尔值还是复杂的嵌套结构，leo 模块都能灵活应对，满足不同场景下的需求。
促进模块化编程：leo 模块的设计鼓励模块化编程，使得代码更加结构化、易于扩展和重用。

## 主要功能
- 因子编码（Factor）
Factor() 函数用于将分类数据编码为整数值，生成因子对象。因子对象不仅保留了原始类别信息，还提供了编码后的数值表示，便于进行统计分析和其他数据处理任务。这对于机器学习、数据分析等领域尤为重要。

- 多维数组创建（Array 和 Matrix）
Array() 和 Matrix() 函数分别用于创建多维数组和二维矩阵，并可以根据指定的参数填充数组。Array() 支持创建2D或3D数组，允许循环填充或线性填充；Matrix() 则专门用于创建二维矩阵，并初始化每个元素的值。这些函数非常适合用于数学计算、图像处理等场景。

- 数据框构建（DataFrame）
DataFrame() 函数用于创建数据框对象，该对象可以存储结构化数据，并提供方便的数据操作接口。数据框支持列式存储，允许对每一列进行独立的操作，如过滤、排序、聚合等。此外，数据框还提供了格式化的输出功能，方便调试和展示数据。

- 列表管理（List）
List() 函数用于创建列表对象，可以从变长参数或单个表中提取元素。列表对象支持动态添加和删除元素，适用于需要频繁修改数据结构的场景。相比于普通的Lua表，List() 提供了更丰富的操作方法，增强了灵活性和易用性。

- 管道操作（Pipe）
pipe() 函数用于创建管道对象，允许通过链式调用的方式对数据进行一系列操作。管道操作使得复杂的转换过程变得更加直观和易用，减少了嵌套调用带来的代码复杂度。通过管道，开发者可以轻松地组合多个函数，实现高效的流水线式数据处理。

- 统计摘要（Summary）
Summary() 函数用于计算一个数值数组的最小值、第一四分位数、中位数、平均值、第三四分位数和最大值。该函数提供了类似于R语言中的summary()函数的功能，帮助用户快速了解数据的基本统计信息。统计摘要对于数据分析和可视化非常有用。

- 条件查找（Which）
Which() 函数用于查找满足给定条件的元素索引。条件可以是一个函数或逻辑数组，Which() 会返回满足条件的元素索引列表。该函数常用于数据筛选和异常检测等场景。

- 缺失值处理（Is_na, Na_omit, Narm）
Is_na() 函数用于检查数值数组中的每个元素是否为nil，并返回一个逻辑数组，指示每个元素的状态。Na_omit() 函数用于移除数值数组中的所有nil元素，返回一个新的数组。Narm() 函数则用于计算数值数组的平均值，忽略数组中的nil元素。这些函数帮助开发者有效地处理缺失数据，确保后续分析的准确性。

---
## Show() - 格式化输出

### 描述
`Show()` 函数用于直接输出信息到控制台。它可以处理任意类型的值，并根据值的类型进行适当的格式化输出。对于表，它会递归地打印出表的内容；对于自定义对象，它会尝试调用对象的`__tostring`元方法；对于其他类型的值，它会直接打印。

### 参数
- `...` (变长参数)：可以是任意类型的值，包括表、自定义对象、字符串、数字等。

### 返回值
- 无返回值，但在控制台打印出格式化的输出。

### 示例
```lua
local my_table = {
    name = "Alice",
    age = 30,
    address = {
        street = "123 Main St",
        city = "Wonderland"
    }
}

leo.Show(my_table)
```

### 输出
```
[Table]
name = Alice
age = 30
address:
  street = 123 Main St
  city = Wonderland
```
--- 
## Factor() - 创建因子对象

### 描述
`Factor()` 函数用于创建一个因子对象，该对象可以将分类数据编码为整数值，从而便于进行统计分析或其他数据处理任务。

### 参数
- `data` (表)：包含要编码的数据的表。每个元素代表一个类别。

### 返回值
- 因子对象，包含以下属性：
  - `levels` (表)：因子的所有水平（即不同的类别）。
  - `level_map` (表)：从原始值到编码值的映射。
  - `encoded_data` (表)：编码后的数据，每个元素是一个整数，表示对应的类别索引。

### 示例
```lua
local factor = leo.Factor({"apple", "banana", "apple", "orange", "banana"})
print("Levels:", table.concat(factor.levels, ", "))
print("Encoded Data:", table.concat(factor.encoded_data, ", "))
```

### 输出
```
Levels: apple, banana, orange
Encoded Data: 1, 2, 1, 3, 2
```

---

## Array() - 创建多维数组

### 描述
`Array()` 函数用于创建一个多维数组（如矩阵或三维数组），并根据指定的参数填充数组。

### 参数
- `dims` (表)：包含每个维度大小的表，支持2D或3D数组。
- `startValue` (数值)：填充数组的起始值。
- `endValue` (数值)：填充数组的结束值。
- `loop` (布尔值)：指示是否在达到`endValue`后循环回开始值。

### 返回值
- 多维数组，根据指定的维度和填充规则生成。

### 示例
```lua
local array_2d_loop = leo.Array({3, 3}, 1, 5, true)
leo.Show(array_2d_loop)
```

### 输出
```
[Table]
1 = 
  1 = 1
  2 = 2
  3 = 3
2 = 
  1 = 4
  2 = 5
  3 = 1
3 = 
  1 = 2
  2 = 3
  3 = 4
```

---

## Matrix() - 创建二维矩阵

### 描述
`Matrix()` 函数用于创建一个二维矩阵，并初始化每个元素的值。

### 参数
- `rows` (整数)：矩阵的行数。
- `cols` (整数)：矩阵的列数。
- `initValue` (任意类型)：初始化每个元素的值。

### 返回值
- 二维矩阵，每个元素被初始化为`initValue`。

### 示例
```lua
local matrix = leo.Matrix(3, 3, 0)
leo.Show(matrix)
```

### 输出
```
[Table]
1 = 
  1 = 0
  2 = 0
  3 = 0
2 = 
  1 = 0
  2 = 0
  3 = 0
3 = 
  1 = 0
  2 = 0
  3 = 0
```

---

## DataFrame() - 创建数据框对象

### 描述
`DataFrame()` 函数用于创建一个数据框对象，该对象可以存储结构化数据，并提供方便的数据操作接口。

### 参数
- `columns` (表)：键是列名，值是列数据的表。所有列必须具有相同的长度。

### 返回值
- 数据框对象，包含以下特性：
  - `numRows` (整数)：数据框的行数。
  - 列数据：每列的数据存储在一个表中，无效数据会被替换为`null`。
  - `__tostring` 元方法：用于`print`函数输出时格式化显示数据框内容。

### 示例
```lua
local df = leo.DataFrame({
    Name = {"Alice", "Bob", "Charlie"},
    Age = {25, 30, 35},
    City = {"New York", "Los Angeles", "Chicago"}
})
print(tostring(df))
```

### 输出
```
DEBUG: Name    Age     City
DEBUG: Alice   25      New York
DEBUG: Bob     30      Los Angeles
DEBUG: Charlie 35      Chicago
Name    Age     City
Alice   25      New York
Bob     30      Los Angeles
Charlie 35      Chicago
```

---

## List() - 创建列表对象

### 描述
`List()` 函数用于创建一个列表对象，可以从变长参数或单个表中提取元素。

### 参数
- `...` (变长参数)：可以是单个值或一个表。

### 返回值
- 列表对象，包含传入的所有元素。

### 示例
```lua
local list = leo.List(1, 2, 3, {4, 5, 6})
print(table.concat(list, ", "))
```

### 输出
```
1, 2, 3, 4, 5, 6
```

---

## pipe() - 创建管道对象

### 描述
`pipe()` 函数用于创建一个管道对象，允许通过链式调用的方式对数据进行一系列操作。

### 参数
- `value` (任意类型)：初始值。
- `...` (可选)：立即执行的函数列表。

### 返回值
- 管道对象，可以通过调用方法继续添加操作，最终返回处理后的结果。

### 示例
```lua
local result = leo.pipe(10)
    :call(function(x) return x + 5 end)
    :call(function(x) return x * 2 end)
    :get()
print(result)  -- 输出 30
```

### 输出
```
30
```


## Summary() - 计算统计摘要

### 描述
`Summary()` 函数用于计算一个数值数组的最小值（Min）、第一四分位数（1st Qu.）、中位数（Median）、平均值（Mean）、第三四分位数（3rd Qu.）和最大值（Max）。该函数旨在提供类似于R语言中的`summary()`函数的功能，方便用户快速了解数据的基本统计信息。

### 参数
- `data` (数值数组)：包含要分析的数据点的表。数组中的元素应为数值类型。

### 返回值
- 无返回值，但在控制台打印出格式化的统计摘要。

### 示例
```lua
local data = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
leo.Summary(data)
```

### 输出
```
   Min. 1st Qu. Median   Mean 3rd Qu.    Max.
   1.0    3.0    5.5    5.5    8.0   10.0
```

---

## Which() - 查找满足条件的元素索引

### 描述
`Which()` 函数用于查找满足给定条件的元素索引。条件可以是一个函数或逻辑数组。如果条件是函数，则会遍历数组中的每个元素，并将满足条件的元素索引返回；如果条件是逻辑数组，则返回对应为`true`的索引。

### 参数
- `condition` (表达式或函数)：用于判断每个元素是否满足条件。可以是函数或逻辑数组。
- `data` (数值数组或逻辑数组)：要检查的数组。

### 返回值
- 索引列表，包含满足条件的元素的索引。

### 示例
```lua
local data = {1, 2, 3, 4, 5}
local indices = leo.Which(function(x) return x > 3 end, data)
print(table.concat(indices, ", "))  -- 输出: 4, 5
```

### 输出
```
4, 5
```

---

## Is_na() - 检查 nil 元素

### 描述
`Is_na()` 函数用于检查数值数组中的每个元素是否为`nil`，并返回一个逻辑数组，指示每个元素的状态。

### 参数
- `data` (数值数组)：要检查的数组。

### 返回值
- 逻辑数组，指示每个元素是否为`nil`。

### 示例
```lua
local data = {1, nil, 3, nil, 5}
local result = leo.Is_na(data)
print(table.concat(result, ", "))  -- 输出: false, true, false, true, false
```

### 输出
```
false, true, false, true, false
```

---

## Na_omit() - 移除 nil 元素

### 描述
`Na_omit()` 函数用于移除数值数组中的所有`nil`元素，并返回一个新的数组。

### 参数
- `data` (数值数组)：要处理的数组。

### 返回值
- 新的数组，移除了所有`nil`元素。

### 示例
```lua
local data = {1, nil, 3, nil, 5}
local result = leo.Na_omit(data)
print(table.concat(result, ", "))  -- 输出: 1, 3, 5
```

### 输出
```
1, 3, 5
```

---

## Narm() - 忽略 nil 计算平均值

### 描述
`Narm()` 函数用于计算数值数组的平均值，忽略数组中的`nil`元素。如果数组中没有非`nil`的数字元素，则返回`nil`。

### 参数
- `t` (数值数组)：可能包含`nil`值的数组。

### 返回值
- 平均值（如果数组中没有非`nil`元素，则返回`nil`）。

### 示例
```lua
local data = {1, nil, 3, nil, 5}
local mean = leo.Narm(data)
print(mean)  -- 输出: 3
```

### 输出
```
3
```

---

## 兼容 Lua 5.1 和 Lua 5.4 的 `unpack`

为了确保代码在不同版本的 Lua 中都能正常工作，`leo` 模块提供了对 `unpack` 函数的兼容性支持。在 Lua 5.1 中，`unpack` 是全局函数；而在 Lua 5.4 中，`unpack` 被移到了 `table.unpack`。因此，`leo` 模块通过以下代码确保 `table.unpack` 在所有版本中都可用：

```lua
if not table.unpack then
    table.unpack = unpack
end
```

---

## 结论

`leo` 模块不仅提供了丰富的数据处理工具，还增加了多个实用的辅助函数，如统计摘要、条件查找、`nil`元素处理、平均值计算以及格式化输出。这些功能使得开发者能够更高效地进行数据分析和调试工作。无论你是从事数据分析、机器学习、科学计算，还是Web或游戏开发，希望 leo 模块都能为你带来显著的便利和性能提升。

如果你有任何问题或需要进一步的帮助，请随时联系我们的开发团队。我们期待你的反馈和建议！

---

**版本**: 1.0.0  
**作者**: 止葸信息扛把子-天才少年B  
**日期**: 2025年1月3日

